<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Audio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        input, button {
            margin: 10px;
        }
        .controls {
            margin-top: 20px;
        }
        #currentTime, #duration {
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Reproductor de Audio</h1>
    <input type="text" id="videoId" placeholder="Ingrese el ID del video">
    <button id="loadAudio">Cargar Audio</button>

    <div class="controls">
        <button id="playAudio" disabled>Reproducir</button>
        <button id="pauseAudio" disabled>Pausar</button>
        <button id="rewindAudio" disabled>Retroceder 10s</button>
        <button id="forwardAudio" disabled>Avanzar 10s</button>
        <br>

        <label for="volumeControl">Volumen:</label>
        <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="1" disabled>
        <br>

        <span id="currentTime">00:00</span> / <span id="duration">00:00</span>
        <br>

        <input type="range" id="seekBar" min="0" value="0" step="0.01" disabled>
    </div>

    <script>
        let audio;
        let isPlaying = false;

        // Cargar audio
        document.getElementById('loadAudio').addEventListener('click', function() {
            const videoId = document.getElementById('videoId').value;
            if (videoId) {
                fetch(`http://localhost:4000/audio?id=${videoId}`)
                    .then(response => response.json())
                    .then(data => {
                        const audioUrl = data.audioUrl;
                        audio = new Audio(audioUrl);
                        audio.addEventListener('loadedmetadata', function() {
                            document.getElementById('duration').innerText = formatTime(audio.duration);
                            document.getElementById('seekBar').max = audio.duration;
                            document.getElementById('playAudio').disabled = false;
                            document.getElementById('pauseAudio').disabled = false;
                            document.getElementById('rewindAudio').disabled = false;
                            document.getElementById('forwardAudio').disabled = false;
                            document.getElementById('volumeControl').disabled = false;
                            document.getElementById('seekBar').disabled = false;
                        });
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                alert('Por favor, ingrese un ID de video.');
            }
        });

        // Reproducir audio
        document.getElementById('playAudio').addEventListener('click', function() {
            if (audio) {
                audio.play().then(() => {
                    isPlaying = true;
                    updateCurrentTime();
                }).catch(error => console.error('Error al reproducir:', error));
            }
        });

        // Pausar audio
        document.getElementById('pauseAudio').addEventListener('click', function() {
            if (audio && isPlaying) {
                audio.pause();
                isPlaying = false;
            }
        });

        // Retroceder 10 segundos
        document.getElementById('rewindAudio').addEventListener('click', function() {
            if (audio) {
                audio.currentTime = Math.max(0, audio.currentTime - 10);
            }
        });

        // Adelantar 10 segundos
        document.getElementById('forwardAudio').addEventListener('click', function() {
            if (audio) {
                audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
            }
        });

        // Controlar volumen
        document.getElementById('volumeControl').addEventListener('input', function() {
            if (audio) {
                audio.volume = this.value;
            }
        });

        // Actualizar barra de progreso y tiempo actual
        audio?.addEventListener('timeupdate', function() {
            document.getElementById('seekBar').value = audio.currentTime;
            document.getElementById('currentTime').innerText = formatTime(audio.currentTime);
        });

        // Actualizar tiempo al mover barra de progreso
        document.getElementById('seekBar').addEventListener('input', function() {
            if (audio) {
                audio.currentTime = this.value;
            }
        });

        // Funci√≥n para actualizar el tiempo actual
        function updateCurrentTime() {
            if (audio && isPlaying) {
                document.getElementById('currentTime').innerText = formatTime(audio.currentTime);
                document.getElementById('seekBar').value = audio.currentTime;
                requestAnimationFrame(updateCurrentTime);
            }
        }

        // Formatear tiempo (mm:ss)
        function formatTime(time) {
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>